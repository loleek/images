# å®Œæ•´ç‰ˆ LaTeX æ‰¹é‡è½¬æ¢å™¨ - åŒ…å«æ‰€æœ‰å­—ä½“å’Œä¸­æ–‡æ”¯æŒ
# ä½¿ç”¨å›½å†…é•œåƒæºçš„ Ubuntu 22.04 ä»¥åŠ é€Ÿä¸‹è½½
FROM registry.cn-hangzhou.aliyuncs.com/acs/ubuntu:22.04

# è®¾ç½®çŽ¯å¢ƒå˜é‡é¿å…äº¤äº’å¼å®‰è£…
ENV DEBIAN_FRONTEND=noninteractive

# æ›´æ¢ä¸ºå›½å†…è½¯ä»¶æºä»¥åŠ é€Ÿå®‰è£…
RUN sed -i 's/archive.ubuntu.com/mirrors.aliyun.com/g' /etc/apt/sources.list && \
    sed -i 's/security.ubuntu.com/mirrors.aliyun.com/g' /etc/apt/sources.list

# ==================== ç¬¬ä¸€é˜¶æ®µï¼šå®‰è£…åŸºç¡€ LaTeX çŽ¯å¢ƒå’Œå·¥å…· ====================
RUN apt-get update && apt-get install -y \
    # åŸºç¡€ LaTeX åŒ…
    texlive-latex-base \
    texlive-latex-recommended \
    texlive-latex-extra \
    texlive-fonts-recommended \
    texlive-fonts-extra \
    texlive-science \
    texlive-font-utils \
    texlive-plain-generic \
    # XeLaTeX å’Œ LuaLaTeX æ”¯æŒ
    texlive-xetex \
    texlive-luatex \
    # ä¸­æ–‡ LaTeX æ”¯æŒ
    texlive-lang-chinese \
    latex-cjk-chinese \
    latex-cjk-chinese-arphic-bkai00mp \
    latex-cjk-chinese-arphic-bsmi00lp \
    latex-cjk-chinese-arphic-gbsn00lp \
    latex-cjk-chinese-arphic-gkai00mp \
    # å›¾ç‰‡è½¬æ¢å·¥å…·
    imagemagick \
    ghostscript \
    poppler-utils \
    # ä¸‹è½½å’Œå­—ä½“å·¥å…·
    wget \
    curl \
    unzip \
    git \
    fontconfig \
    && rm -rf /var/lib/apt/lists/*

# é…ç½® ImageMagick å®‰å…¨ç­–ç•¥ï¼Œå…è®¸å¤„ç† PDF
RUN sed -i 's/rights="none" pattern="PDF"/rights="read|write" pattern="PDF"/g' /etc/ImageMagick-6/policy.xml

# ==================== ç¬¬äºŒé˜¶æ®µï¼šå®‰è£…ä¸­æ–‡å­—ä½“ ====================
RUN apt-get update && apt-get install -y \
    # åŸºç¡€ä¸­æ–‡å­—ä½“
    fonts-noto-cjk \
    fonts-noto-cjk-extra \
    fonts-noto-extra \
    fonts-wqy-microhei \
    fonts-wqy-zenhei \
    fonts-arphic-ukai \
    fonts-arphic-uming \
    fonts-arphic-bkai00mp \
    fonts-arphic-gkai00mp \
    && rm -rf /var/lib/apt/lists/*

# ==================== ç¬¬ä¸‰é˜¶æ®µï¼šåˆ›å»ºå­—ä½“ç›®å½•ç»“æž„ ====================
RUN mkdir -p /usr/share/fonts/truetype/custom
RUN mkdir -p /usr/share/fonts/truetype/google-fonts
RUN mkdir -p /usr/share/fonts/truetype/handwriting
RUN mkdir -p /usr/share/fonts/truetype/chinese-handwriting
RUN mkdir -p /usr/share/fonts/truetype/zcool
RUN mkdir -p /usr/share/fonts/truetype/alibaba
RUN mkdir -p /usr/share/fonts/truetype/creative
RUN mkdir -p /usr/share/fonts/truetype/enhanced

# è®¾ç½®ä¸´æ—¶å·¥ä½œç›®å½•
WORKDIR /tmp/fonts

# ==================== ç¬¬å››é˜¶æ®µï¼šä¸‹è½½ Google Fonts æ‰‹å†™ä½“å­—ä½“ ====================
RUN echo "ä¸‹è½½ Google Fonts æ‰‹å†™ä½“å­—ä½“..." && \
    cd /usr/share/fonts/truetype/google-fonts && \
    # Patrick Hand - æ‰‹å†™ä½“
    (wget -O PatrickHand-Regular.ttf "https://github.com/google/fonts/raw/main/ofl/patrickhand/PatrickHand-Regular.ttf" || echo "Patrick Hand ä¸‹è½½å¤±è´¥") && \
    # Homemade Apple - æ‰‹å·¥é£Žæ ¼
    (wget -O HomemadeApple-Regular.ttf "https://github.com/google/fonts/raw/main/apache/homemadeapple/HomemadeApple-Regular.ttf" || echo "Homemade Apple ä¸‹è½½å¤±è´¥") && \
    # Dancing Script - èˆžåŠ¨æ‰‹å†™ä½“
    (wget -O DancingScript-Regular.ttf "https://github.com/google/fonts/raw/main/ofl/dancingscript/DancingScript%5Bwght%5D.ttf" || echo "Dancing Script ä¸‹è½½å¤±è´¥") && \
    # Shadows Into Light - é˜´å½±ä½“ (ä¿®å¤URL)
    (wget -O ShadowsIntoLight-Regular.ttf "https://github.com/google/fonts/raw/main/ofl/shadowsintolight/ShadowsIntoLight-Regular.ttf" || \
     wget -O ShadowsIntoLight-Regular.ttf "https://fonts.gstatic.com/s/shadowsintolight/v19/UqyNK9UOIntux_czAvDQx_ZcHqZXBNQDcsr4xzSMYA.ttf" || \
     echo "Shadows Into Light ä¸‹è½½å¤±è´¥") && \
    # Amatic SC - æ‰‹ç»˜é£Žæ ¼ (ä¿®å¤URL)
    (wget -O AmaticSC-Regular.ttf "https://github.com/google/fonts/raw/main/ofl/amaticsc/AmaticSC-Regular.ttf" || \
     wget -O AmaticSC-Regular.ttf "https://fonts.gstatic.com/s/amaticsc/v26/TUZyzwprpvBS1izr_vOMscDJvBs.ttf" || \
     echo "Amatic SC Regular ä¸‹è½½å¤±è´¥") && \
    (wget -O AmaticSC-Bold.ttf "https://github.com/google/fonts/raw/main/ofl/amaticsc/AmaticSC-Bold.ttf" || \
     wget -O AmaticSC-Bold.ttf "https://fonts.gstatic.com/s/amaticsc/v26/TUZ3zwprpvBS1izr_vO0De6ecZQf-A.ttf" || \
     echo "Amatic SC Bold ä¸‹è½½å¤±è´¥") && \
    # Handlee - è‡ªç„¶æ‰‹å†™ä½“
    (wget -O Handlee-Regular.ttf "https://github.com/google/fonts/raw/main/ofl/handlee/Handlee-Regular.ttf" || echo "Handlee ä¸‹è½½å¤±è´¥") && \
    # Kalam - çŽ°ä»£æ‰‹å†™ä½“
    (wget -O Kalam-Regular.ttf "https://github.com/google/fonts/raw/main/ofl/kalam/Kalam-Regular.ttf" || echo "Kalam ä¸‹è½½å¤±è´¥") && \
    # Caveat - éšæ„é£Žæ ¼
    (wget -O Caveat-Regular.ttf "https://github.com/google/fonts/raw/main/ofl/caveat/Caveat%5Bwght%5D.ttf" || echo "Caveat ä¸‹è½½å¤±è´¥") && \
    # Architects Daughter - å»ºç­‘å¸ˆå¥³å„¿ä½“
    (wget -O ArchitectsDaughter-Regular.ttf "https://github.com/google/fonts/raw/main/ofl/architectsdaughter/ArchitectsDaughter-Regular.ttf" || echo "Architects Daughter ä¸‹è½½å¤±è´¥") && \
    # Indie Flower - ç‹¬ç«‹èŠ±ä½“
    (wget -O IndieFlower-Regular.ttf "https://github.com/google/fonts/raw/main/ofl/indieflower/IndieFlower-Regular.ttf" || echo "Indie Flower ä¸‹è½½å¤±è´¥") && \
    # Nothing You Could Do - éšæ€§ä½“
    (wget -O NothingYouCouldDo-Regular.ttf "https://github.com/google/fonts/raw/main/ofl/nothingyoucoulddo/NothingYouCouldDo-Regular.ttf" || echo "Nothing You Could Do ä¸‹è½½å¤±è´¥") && \
    echo "Google Fonts å­—ä½“ä¸‹è½½å®Œæˆ"

# ==================== ç¬¬äº”é˜¶æ®µï¼šä¸‹è½½ç«™é…·å­—ä½“ç³»åˆ— ====================
RUN echo "ä¸‹è½½ç«™é…·å­—ä½“ç³»åˆ—..." && \
    cd /usr/share/fonts/truetype/zcool && \
    # ç«™é…·å¿«ä¹ä½“
    wget -O ZcoolKuaiLe-Regular.ttf "https://fonts.gstatic.com/s/zcoolkuaile/v11/tssQApxBaigK_hnnc1qPcEU3dSuLDU-4Gb1s.ttf" && \
    # ç«™é…·å°å¾®ä½“
    wget -O ZcoolXiaoWei-Regular.ttf "https://fonts.gstatic.com/s/zcoolxiaowei/v10/i7dMIFByZjaNAMxtZcnfAy5H2S6S7gTtJLfE.ttf" && \
    # å°è¯•ä¸‹è½½ç«™é…·é’ç§‘é»„æ²¹ä½“
    git clone --depth 1 https://github.com/googlefonts/zcool-qingke-huangyou.git qingke 2>/dev/null && \
    if [ -d qingke ]; then \
        find qingke -name "*.ttf" -o -name "*.otf" | xargs -I {} cp {} .; \
        rm -rf qingke; \
    fi || echo "ç«™é…·é’ç§‘é»„æ²¹ä½“ä¸‹è½½å¤±è´¥ï¼Œè·³è¿‡"

# ==================== ç¬¬å…­é˜¶æ®µï¼šä¸‹è½½é˜¿é‡Œå·´å·´æ™®æƒ ä½“ ====================
RUN echo "ä¸‹è½½é˜¿é‡Œå·´å·´æ™®æƒ ä½“..." && \
    cd /usr/share/fonts/truetype/alibaba && \
    # ä»Žé˜¿é‡Œå·´å·´å®˜æ–¹æºä¸‹è½½
    wget -O AlibabaSans.zip "https://puhuiti.oss-cn-hangzhou.aliyuncs.com/AlibabaSans.zip" && \
    if [ -f AlibabaSans.zip ]; then \
        unzip -q AlibabaSans.zip; \
        rm -f AlibabaSans.zip; \
    fi || \
    # å¤‡ç”¨ä¸‹è½½æº
    wget -O AlibabaSans-Regular.ttf "https://github.com/AlibabaPuHuiTi/AlibabaPuHuiTi/releases/download/v3.0.0/AlibabaSans-Regular.ttf" || \
    echo "é˜¿é‡Œå·´å·´æ™®æƒ ä½“ä¸‹è½½å¤±è´¥ï¼Œè·³è¿‡"

# ==================== ç¬¬ä¸ƒé˜¶æ®µï¼šä¸‹è½½å¼€æºä¸­æ–‡åˆ›æ„å­—ä½“ ====================
RUN echo "ä¸‹è½½å¼€æºä¸­æ–‡åˆ›æ„å­—ä½“..." && \
    cd /usr/share/fonts/truetype/creative && \
    # å¾—æ„é»‘ï¼ˆçŽ°ä»£åˆ›æ„å­—ä½“ï¼‰
    wget -O SmileySans-Oblique.ttf "https://github.com/atelier-anchor/smiley-sans/releases/download/v2.0.1/SmileySans-Oblique.ttf" && \
    # éœžé¹œæ–‡æ¥·ï¼ˆæ‰‹å†™æ¥·ä½“é£Žæ ¼ï¼‰
    wget -O LXGWWenKai-Regular.ttf "https://github.com/lxgw/LxgwWenKai/releases/download/v1.330/LXGWWenKai-Regular.ttf" && \
    wget -O LXGWWenKai-Bold.ttf "https://github.com/lxgw/LxgwWenKai/releases/download/v1.330/LXGWWenKai-Bold.ttf" && \
    # éœžé¹œæ–°æ™°é»‘ï¼ˆçŽ°ä»£é»‘ä½“ï¼‰
    wget -O LXGWNewClear-Regular.ttf "https://github.com/lxgw/LxgwNewClear/releases/download/v1.021/LXGWNewClear-Regular.ttf" || \
    echo "éƒ¨åˆ†åˆ›æ„å­—ä½“ä¸‹è½½å¤±è´¥ï¼Œç»§ç»­"

# ==================== ç¬¬å…«é˜¶æ®µï¼šä¸‹è½½æ›´å¤šæ‰‹å†™é£Žæ ¼å­—ä½“ ====================
RUN echo "ä¸‹è½½æ›´å¤šæ‰‹å†™é£Žæ ¼å­—ä½“..." && \
    cd /usr/share/fonts/truetype/handwriting && \
    # æ±Ÿè¥¿æ‹™æ¥·ï¼ˆæ‰‹å†™æ¥·ä½“ï¼‰
    wget -O JiangxiZhuoKai-Regular.ttf "https://github.com/TrionesType/zhuoque/releases/download/v1.002/TrionesZhuoKai-Regular.ttf" && \
    # ä»“è€³ä»Šæ¥·ï¼ˆçŽ°ä»£æ¥·ä½“ï¼‰
    wget -O TsangerJinKai-Regular.ttf "https://github.com/tsanger/Tsanger/releases/download/v2.042/TsangerJinKai03-W03.ttf" && \
    # ä¼˜è®¾æ ‡é¢˜é»‘ï¼ˆåˆ›æ„é»‘ä½“ï¼‰
    wget -O YousheBiaotihei-Regular.ttf "https://github.com/atelier-anchor/smiley-sans/releases/download/v2.0.1/SmileySans-Oblique.ttf" || \
    echo "éƒ¨åˆ†æ‰‹å†™å­—ä½“ä¸‹è½½å¤±è´¥ï¼Œç»§ç»­"

# ==================== ç¬¬ä¹é˜¶æ®µï¼šåˆ›å»ºå­—ä½“å›žé€€é“¾æŽ¥å’Œåˆ«å ====================
RUN echo "åˆ›å»ºå­—ä½“å›žé€€æœºåˆ¶å’Œåˆ«å..." && \
    # åˆ›å»ºå­—ä½“åˆ«åé…ç½®æ–‡ä»¶
    mkdir -p /etc/fonts/conf.d && \
    tee /etc/fonts/conf.d/99-font-aliases.conf > /dev/null << 'FONTEOF'
<?xml version="1.0"?>
<!DOCTYPE fontconfig SYSTEM "fonts.dtd">
<fontconfig>
  <!-- Google Fonts åˆ«å -->
  <alias>
    <family>Patrick Hand</family>
    <prefer><family>PatrickHand-Regular</family></prefer>
  </alias>
  <alias>
    <family>Homemade Apple</family>
    <prefer><family>HomemadeApple-Regular</family></prefer>
  </alias>
  <alias>
    <family>Dancing Script</family>
    <prefer><family>DancingScript-Regular</family></prefer>
  </alias>
  <alias>
    <family>Shadows Into Light</family>
    <prefer><family>ShadowsIntoLight-Regular</family></prefer>
  </alias>
  <alias>
    <family>Amatic SC</family>
    <prefer><family>AmaticSC-Regular</family></prefer>
  </alias>
  
  <!-- å­—ä½“å›žé€€æœºåˆ¶ -->
  <alias>
    <family>Patrick Hand</family>
    <prefer>
      <family>PatrickHand-Regular</family>
      <family>Handlee-Regular</family>
      <family>IndieFlower-Regular</family>
      <family>DejaVu Sans</family>
    </prefer>
  </alias>
  
  <alias>
    <family>Shadows Into Light</family>
    <prefer>
      <family>ShadowsIntoLight-Regular</family>
      <family>PatrickHand-Regular</family>
      <family>Handlee-Regular</family>
      <family>DejaVu Sans</family>
    </prefer>
  </alias>
  
  <alias>
    <family>Amatic SC</family>
    <prefer>
      <family>AmaticSC-Regular</family>
      <family>PatrickHand-Regular</family>
      <family>DejaVu Sans</family>
    </prefer>
  </alias>
  
  <!-- ç«™é…·å­—ä½“å›žé€€ -->
  <alias>
    <family>ZcoolKuaiLe</family>
    <prefer>
      <family>ZcoolKuaiLe-Regular</family>
      <family>LXGWWenKai-Regular</family>
      <family>Noto Sans CJK SC</family>
    </prefer>
  </alias>
</fontconfig>
FONTEOF

# åˆ›å»ºå­—ä½“å›žé€€é“¾æŽ¥
RUN echo "åˆ›å»ºå­—ä½“å›žé€€é“¾æŽ¥..." && \
    # å¦‚æžœæŸäº›å­—ä½“ä¸‹è½½å¤±è´¥ï¼Œä½¿ç”¨å·²æœ‰å­—ä½“ä½œä¸ºå›žé€€
    cd /usr/share/fonts/truetype/zcool && \
    if [ ! -f ZcoolKuaiLe-Regular.ttf ] && [ -f /usr/share/fonts/truetype/creative/LXGWWenKai-Regular.ttf ]; then \
        ln -sf /usr/share/fonts/truetype/creative/LXGWWenKai-Regular.ttf ZcoolKuaiLe-Regular.ttf; \
    fi && \
    if [ ! -f ZcoolXiaoWei-Regular.ttf ] && [ -f /usr/share/fonts/opentype/noto/NotoSansCJK-Regular.ttc ]; then \
        ln -sf /usr/share/fonts/opentype/noto/NotoSansCJK-Regular.ttc ZcoolXiaoWei-Regular.ttf; \
    fi && \
    # ä¸ºç¼ºå¤±çš„Google Fontsåˆ›å»ºå›žé€€é“¾æŽ¥
    cd /usr/share/fonts/truetype/google-fonts && \
    if [ ! -f ShadowsIntoLight-Regular.ttf ] && [ -f PatrickHand-Regular.ttf ]; then \
        ln -sf PatrickHand-Regular.ttf ShadowsIntoLight-Regular.ttf; \
    fi && \
    if [ ! -f AmaticSC-Regular.ttf ] && [ -f PatrickHand-Regular.ttf ]; then \
        ln -sf PatrickHand-Regular.ttf AmaticSC-Regular.ttf; \
    fi

# ==================== ç¬¬åé˜¶æ®µï¼šè®¾ç½®å­—ä½“æƒé™å’Œæ›´æ–°ç¼“å­˜ ====================
RUN echo "è®¾ç½®å­—ä½“æƒé™å’Œæ›´æ–°ç¼“å­˜..." && \
    # è®¾ç½®æ‰€æœ‰å­—ä½“æ–‡ä»¶çš„æ­£ç¡®æƒé™
    find /usr/share/fonts/truetype -type f \( -name "*.ttf" -o -name "*.otf" \) -exec chmod 644 {} \; 2>/dev/null || true && \
    # æ›´æ–°å­—ä½“ç¼“å­˜
    fc-cache -fv

# ==================== ç¬¬åä¸€é˜¶æ®µï¼šåˆ›å»ºå·¥ä½œç›®å½•å’Œè„šæœ¬ ====================
WORKDIR /workspace

# å¤åˆ¶è½¬æ¢è„šæœ¬
COPY convert_fixed.sh /usr/local/bin/convert.sh
COPY batch_convert.sh /usr/local/bin/batch_convert.sh
COPY batch_convert_parallel.sh /usr/local/bin/batch_convert_parallel.sh
RUN chmod +x /usr/local/bin/convert.sh /usr/local/bin/batch_convert.sh /usr/local/bin/batch_convert_parallel.sh

# ==================== ç¬¬åäºŒé˜¶æ®µï¼šåˆ›å»ºå­—ä½“ç®¡ç†è„šæœ¬ ====================
RUN cat > /usr/local/bin/list-all-fonts.sh << 'EOF'
#!/bin/bash
echo "ðŸŽ¨ LaTeX å®Œæ•´ç‰ˆå­—ä½“åº“ - å®‰è£…æƒ…å†µæŠ¥å‘Š"
echo "=============================================="
echo ""

echo "ðŸ“Š å­—ä½“ç»Ÿè®¡ï¼š"
echo "  æ€»å­—ä½“æ•°é‡: $(fc-list | wc -l)"
echo "  ä¸­æ–‡å­—ä½“æ•°é‡: $(fc-list :lang=zh | wc -l)"
echo "  è‹±æ–‡å­—ä½“æ•°é‡: $(fc-list :lang=en | wc -l)"
echo ""

echo "ðŸ”¤ Google Fonts æ‰‹å†™ä½“ç³»åˆ—ï¼š"
cd /usr/share/fonts/truetype/google-fonts 2>/dev/null || echo "  ç›®å½•ä¸å­˜åœ¨"
ls -1 *.ttf 2>/dev/null | while read font; do
    echo "  âœ… $font"
done || echo "  âŒ æœªæ‰¾åˆ° Google Fonts"
echo ""

echo "ðŸŽ¨ ç«™é…·å­—ä½“ç³»åˆ—ï¼š"
echo "  ç«™é…·å¿«ä¹ä½“: $(fc-list | grep -i 'kuaile\|å¿«ä¹' | wc -l) ä¸ª"
echo "  ç«™é…·å°å¾®ä½“: $(fc-list | grep -i 'xiaowei\|å°å¾®' | wc -l) ä¸ª"
echo "  ç«™é…·é’ç§‘é»„æ²¹ä½“: $(fc-list | grep -i 'qingke\|huangyou\|é’ç§‘\|é»„æ²¹' | wc -l) ä¸ª"
echo ""

echo "ðŸ¢ é˜¿é‡Œå·´å·´æ™®æƒ ä½“ç³»åˆ—ï¼š"
echo "  æ™®æƒ ä½“æ•°é‡: $(fc-list | grep -i 'alibaba\|puhuiti\|æ™®æƒ ' | wc -l) ä¸ª"
echo ""

echo "âœï¸ åˆ›æ„å’Œæ‰‹å†™å­—ä½“ï¼š"
echo "  å¾—æ„é»‘: $(fc-list | grep -i 'smiley\|å¾—æ„' | wc -l) ä¸ª"
echo "  éœžé¹œæ–‡æ¥·: $(fc-list | grep -i 'lxgw\|wenkai\|æ–‡æ¥·' | wc -l) ä¸ª"
echo "  æ±Ÿè¥¿æ‹™æ¥·: $(fc-list | grep -i 'jiangxi\|zhuokai\|æ‹™æ¥·' | wc -l) ä¸ª"
echo "  ä»“è€³ä»Šæ¥·: $(fc-list | grep -i 'tsanger\|ä»Šæ¥·' | wc -l) ä¸ª"
echo ""

echo "ðŸŒ ä¼ ç»Ÿä¸­æ–‡å­—ä½“ï¼š"
echo "  æ–‡æ³‰é©¿å­—ä½“: $(fc-list | grep -i 'wenquanyi\|æ–‡æ³‰é©¿' | wc -l) ä¸ª"
echo "  æ€æºå­—ä½“: $(fc-list | grep -i 'noto\|source.*han' | wc -l) ä¸ª"
echo "  æ–¹æ­£å­—ä½“: $(fc-list | grep -i 'arphic\|æ–¹æ­£' | wc -l) ä¸ª"
echo ""

echo "ðŸ“ å­—ä½“ç›®å½•è¯¦æƒ…ï¼š"
echo "  Google Fonts: $(ls /usr/share/fonts/truetype/google-fonts/*.ttf 2>/dev/null | wc -l) ä¸ªæ–‡ä»¶"
echo "  ç«™é…·å­—ä½“: $(ls /usr/share/fonts/truetype/zcool/*.ttf 2>/dev/null | wc -l) ä¸ªæ–‡ä»¶"
echo "  é˜¿é‡Œå·´å·´å­—ä½“: $(find /usr/share/fonts/truetype/alibaba -name "*.ttf" 2>/dev/null | wc -l) ä¸ªæ–‡ä»¶"
echo "  åˆ›æ„å­—ä½“: $(ls /usr/share/fonts/truetype/creative/*.ttf 2>/dev/null | wc -l) ä¸ªæ–‡ä»¶"
echo "  æ‰‹å†™å­—ä½“: $(ls /usr/share/fonts/truetype/handwriting/*.ttf 2>/dev/null | wc -l) ä¸ªæ–‡ä»¶"
echo ""

echo "ðŸ”§ LaTeX ä½¿ç”¨ç¤ºä¾‹ï¼š"
echo "  \\usepackage{xeCJK}"
echo "  \\setCJKmainfont{Noto Sans CJK SC}           % æ€æºé»‘ä½“"
echo "  \\setCJKmainfont{LXGWWenKai-Regular}         % éœžé¹œæ–‡æ¥·"
echo "  \\setCJKmainfont{ZcoolKuaiLe-Regular}        % ç«™é…·å¿«ä¹ä½“"
echo "  \\newfontfamily\\alibaba{Alibaba Sans}        % é˜¿é‡Œå·´å·´æ™®æƒ ä½“"
echo "  \\newfontfamily\\handwrite{Patrick Hand}      % Googleæ‰‹å†™ä½“"
echo ""

echo "ðŸ’¡ ä½¿ç”¨æç¤ºï¼š"
echo "  - ä¸­æ–‡å­—ä½“å»ºè®®ä½¿ç”¨ XeLaTeX ç¼–è¯‘"
echo "  - è‹±æ–‡æ‰‹å†™ä½“å¯ä¸Žä¸­æ–‡å­—ä½“æ··åˆä½¿ç”¨"
echo "  - è¿è¡Œ 'fc-list :lang=zh' æŸ¥çœ‹æ‰€æœ‰ä¸­æ–‡å­—ä½“"
echo "  - è¿è¡Œ 'fc-list | grep -i handwrite' æŸ¥çœ‹æ‰‹å†™ä½“"
echo ""
echo "=============================================="
EOF

RUN chmod +x /usr/local/bin/list-all-fonts.sh

# ==================== ç¬¬åä¸‰é˜¶æ®µï¼šåˆ›å»ºå­—ä½“æµ‹è¯•è„šæœ¬ ====================
RUN cat > /usr/local/bin/test-fonts.sh << 'EOF'
#!/bin/bash
echo "ðŸ§ª å­—ä½“åŠŸèƒ½æµ‹è¯•"
echo "åˆ›å»ºå­—ä½“æµ‹è¯•æ–‡æ¡£..."

cat > /tmp/font-test.tex << 'TEXEOF'
\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{xeCJK}
\usepackage{amsmath}
\usepackage{geometry}
\geometry{a4paper, margin=1in}

% è®¾ç½®ä¸­æ–‡å­—ä½“
\setCJKmainfont{Noto Sans CJK SC}
\newfontfamily\wenkai{LXGWWenKai-Regular}
\newfontfamily\zcool{ZcoolKuaiLe-Regular}
\newfontfamily\handwrite{Patrick Hand}

\title{å­—ä½“æµ‹è¯•æ–‡æ¡£}
\author{LaTeX Complete Font Tester}
\date{\today}

\begin{document}

\maketitle

\section{é»˜è®¤ä¸­æ–‡å­—ä½“æµ‹è¯•}

è¿™æ˜¯ä½¿ç”¨ Noto Sans CJK SC (æ€æºé»‘ä½“) çš„ä¸­æ–‡æ–‡æœ¬ã€‚åŒ…å«æ•°å­¦å…¬å¼ï¼š$E = mc^2$

\section{ç‰¹æ®Šå­—ä½“æµ‹è¯•}

{\wenkai è¿™æ˜¯ä½¿ç”¨éœžé¹œæ–‡æ¥·çš„ä¸­æ–‡æ–‡æœ¬ï¼Œå…·æœ‰æ‰‹å†™æ¥·ä½“é£Žæ ¼ã€‚}

{\zcool è¿™æ˜¯ä½¿ç”¨ç«™é…·å¿«ä¹ä½“çš„ä¸­æ–‡æ–‡æœ¬ï¼Œå…·æœ‰çŽ°ä»£è®¾è®¡æ„Ÿã€‚}

\section{è‹±æ–‡æ‰‹å†™ä½“æµ‹è¯•}

{\handwrite This is English text using Patrick Hand font, which has a handwriting style.}

\section{æ•°å­¦å…¬å¼æµ‹è¯•}

äºŒæ¬¡æ–¹ç¨‹æ±‚è§£å…¬å¼ï¼š
\begin{equation}
x = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}
\end{equation}

çŸ©é˜µç¤ºä¾‹ï¼š
\begin{equation}
\begin{pmatrix}
1 & 2 & 3 \\
4 & 5 & 6 \\
7 & 8 & 9
\end{pmatrix}
\end{equation}

\end{document}
TEXEOF

echo "ç¼–è¯‘æµ‹è¯•æ–‡æ¡£..."
cd /tmp
xelatex -interaction=nonstopmode font-test.tex > /dev/null 2>&1

if [ -f font-test.pdf ]; then
    echo "âœ… å­—ä½“æµ‹è¯•æˆåŠŸï¼ç”Ÿæˆäº† font-test.pdf"
    echo "ðŸ“„ PDFé¡µæ•°: $(pdfinfo font-test.pdf | grep Pages | awk '{print $2}')"
else
    echo "âŒ å­—ä½“æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥å­—ä½“å®‰è£…"
fi

rm -f font-test.* 2>/dev/null || true
echo "ðŸ§ª å­—ä½“æµ‹è¯•å®Œæˆ"
EOF

RUN chmod +x /usr/local/bin/test-fonts.sh

# ==================== ç¬¬åå››é˜¶æ®µï¼šæ¸…ç†å’Œæœ€ç»ˆè®¾ç½® ====================
# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
RUN rm -rf /tmp/fonts

# åˆ›å»ºå­—ä½“æ˜ å°„æ–‡æ¡£
RUN cat > /usr/share/fonts/FONT_MAPPING.md << 'EOF'
# å®Œæ•´å­—ä½“æ˜ å°„è¡¨

## ä¸­æ–‡å­—ä½“
- **Noto Sans CJK SC**: æ€æºé»‘ä½“ç®€ä½“ (Googleå¼€æº)
- **Noto Serif CJK SC**: æ€æºå®‹ä½“ç®€ä½“ (Googleå¼€æº)
- **WenQuanYi Zen Hei**: æ–‡æ³‰é©¿æ­£é»‘ (å¼€æºé»‘ä½“)
- **WenQuanYi Micro Hei**: æ–‡æ³‰é©¿å¾®ç±³é»‘ (å°å­—å·)
- **AR PL UKai CN**: æ¥·ä½“é£Žæ ¼ (ä¼ ç»Ÿæ¥·ä½“)
- **LXGWWenKai-Regular**: éœžé¹œæ–‡æ¥· (æ‰‹å†™æ¥·ä½“)
- **ZcoolKuaiLe-Regular**: ç«™é…·å¿«ä¹ä½“ (çŽ°ä»£è®¾è®¡)
- **ZcoolXiaoWei-Regular**: ç«™é…·å°å¾®ä½“ (ç²¾è‡´é£Žæ ¼)
- **Alibaba Sans**: é˜¿é‡Œå·´å·´æ™®æƒ ä½“ (ä¼ä¸šçº§å­—ä½“)
- **SmileySans-Oblique**: å¾—æ„é»‘ (çŽ°ä»£åˆ›æ„)

## è‹±æ–‡æ‰‹å†™ä½“
- **Patrick Hand**: è‡ªç„¶æ‰‹å†™é£Žæ ¼
- **Dancing Script**: ä¼˜é›…èˆžåŠ¨é£Žæ ¼
- **Handlee**: æ¸…æ™°æ‰‹å†™ä½“
- **Caveat**: éšæ„æ¶‚é¸¦é£Žæ ¼
- **Amatic SC**: æ‰‹ç»˜è‰ºæœ¯é£Žæ ¼
- **Architects Daughter**: å»ºç­‘å¸ˆé£Žæ ¼
- **Indie Flower**: å¯çˆ±èŠ±ä½“é£Žæ ¼
- **Shadows Into Light**: è‰ºæœ¯é˜´å½±é£Žæ ¼

## ä½¿ç”¨å»ºè®®
- ä¸­æ–‡æ–‡æ¡£å»ºè®®ä½¿ç”¨ XeLaTeX ç¼–è¯‘
- æ•°å­¦å…¬å¼å¯é…åˆä»»æ„å­—ä½“ä½¿ç”¨
- æ··åˆä½¿ç”¨ä¸­è‹±æ–‡å­—ä½“æ•ˆæžœæ›´ä½³
EOF

# æ˜¾ç¤ºå®‰è£…å®Œæˆä¿¡æ¯
RUN echo "ðŸŽ‰ LaTeX å®Œæ•´ç‰ˆæž„å»ºå®Œæˆï¼" && \
    echo "ðŸ“Š å®‰è£…çš„å­—ä½“æ€»æ•°: $(fc-list | wc -l)" && \
    echo "ðŸ”¤ è¿è¡Œ 'list-all-fonts.sh' æŸ¥çœ‹è¯¦ç»†å­—ä½“ä¿¡æ¯" && \
    echo "ðŸ§ª è¿è¡Œ 'test-fonts.sh' æµ‹è¯•å­—ä½“åŠŸèƒ½" && \
    echo "ðŸ“š æŸ¥çœ‹ /usr/share/fonts/FONT_MAPPING.md äº†è§£å­—ä½“æ˜ å°„"

# è®¾ç½®å…¥å£ç‚¹ä¸ºæ‰¹é‡è½¬æ¢è„šæœ¬
ENTRYPOINT ["/usr/local/bin/batch_convert.sh"] 
